# Meshery Blog Search

This implementation adds client-side search functionality to the Meshery blog, hosted on GitHub Pages.

## Overview

The search implementation uses client-side JavaScript to search through blog posts without requiring any external services or API keys. All search happens in the browser using a JSON feed of blog posts.

## Components

### 1. JSON Feed (`/blog/search.json`)
A Jekyll-generated JSON file containing all blog posts with their metadata:
- ID, title, URL, date
- Author and categories
- Excerpt and full content

This file is automatically generated when the Jekyll site builds.

### 2. Search JavaScript (`/js/blog-search.js`)
Client-side JavaScript that:
- Loads the JSON feed on first search
- Performs real-time search with debouncing (300ms)
- Displays search results with highlighted matches
- Manages UI state (showing/hiding results)
- Includes security features (regex escaping, input sanitization)

### 3. Blog Page Updates (`/blog/index.html`)
Enhanced blog page with:
- Search input field
- Clear button (×) that appears when typing
- Search results container
- Responsive styling matching the existing blog design

## Features

- **Real-time search**: Results appear as you type (with 300ms debouncing)
- **Highlighted matches**: Search terms are highlighted in results
- **Responsive design**: Works on mobile and desktop
- **Clear functionality**: Easy to clear search and return to normal view
- **No external dependencies**: Pure client-side, no API keys needed
- **GitHub Pages compatible**: Works perfectly with static hosting
- **Security hardened**: Regex injection protection and input sanitization

## How It Works

### Search Flow

1. **User types in search box**
   - Input event triggers debounced handler (300ms delay)
   - Clear button (×) appears

2. **First search loads data**
   - JSON feed is fetched: `/blog/search.json`
   - Data cached in memory for subsequent searches

3. **Search execution**
   - Searches across: title, content, excerpt, categories, author
   - Case-insensitive matching
   - Returns top 20 results

4. **Results rendering**
   - Original blog posts hidden
   - Search results displayed with highlighting
   - Results styled to match regular blog posts

5. **Clear search**
   - Click × button or clear input
   - Search results hidden
   - Original blog posts restored

## Browser Support

- Modern browsers with ES6+ support
- Requires JavaScript enabled
- Works on all devices (desktop, tablet, mobile)

## Performance

- Initial load: Fetches search.json (typically 50-200KB)
- Search: Instant (in-memory JavaScript filter)
- Debouncing: 300ms delay between searches
- Results limited to 20 items

## Maintenance

### When Blog Posts Change

The search index automatically updates when:
- Jekyll rebuilds the site (on `git push` to GitHub Pages)
- No manual intervention needed
- No external services to configure

### Modifying Search Behavior

**To change which fields are searched:**
Edit the `performClientSearch()` function in `/js/blog-search.js`

**To adjust result count:**
Change `slice(0, 20)` in the search function

**To modify debounce timing:**
Change the value in `debounce(handleSearchInput, 300)`

## Code Examples

### Search Function
```javascript
function performClientSearch(query) {
  if (!searchData) return [];
  
  const lowerQuery = query.toLowerCase();
  const results = searchData
    .filter(post => {
      const titleMatch = post.title?.toLowerCase().includes(lowerQuery);
      const excerptMatch = post.excerpt?.toLowerCase().includes(lowerQuery);
      const contentMatch = post.content?.toLowerCase().includes(lowerQuery);
      const categoryMatch = post.categories?.some(cat => cat.toLowerCase().includes(lowerQuery));
      const authorMatch = post.author?.toLowerCase().includes(lowerQuery);
      
      return titleMatch || excerptMatch || contentMatch || categoryMatch || authorMatch;
    })
    .slice(0, 20);

  // Highlight matches
  results.forEach(result => {
    result._formatted = {
      title: highlightText(result.title, query),
      excerpt: highlightText(result.excerpt, query)
    };
  });
  
  return results;
}
```

### Highlighting Function
```javascript
function highlightText(text, query) {
  if (!text) return '';
  const escapedQuery = escapeRegex(query);
  const regex = new RegExp(`(${escapedQuery})`, 'gi');
  return text.replace(regex, '<mark class="search-highlight">$1</mark>');
}
```

## Security

### Implemented Protections

1. **Regex Injection Prevention**
   ```javascript
   function escapeRegex(string) {
     return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
   }
   ```

2. **Input Validation**
   - Minimum 2 characters required for search
   - Query trimmed before processing
   - Debouncing prevents excessive processing

3. **Slug Generation**
   ```javascript
   function slugify(text) {
     return text.toString().toLowerCase().trim()
       .replace(/\s+/g, '-')
       .replace(/[^\w\-]+/g, '')
       .replace(/\-\-+/g, '-')
       .replace(/^-+/, '')
       .replace(/-+$/, '');
   }
   ```

## Troubleshooting

### Search not working
1. Check browser console for errors
2. Verify `/blog/search.json` is accessible
3. Ensure JavaScript is enabled

### No results found
1. Check if search query matches post content
2. Try different keywords
3. Verify JSON feed is populated

### Slow performance
1. Check size of search.json file
2. Consider reducing content in JSON (e.g., exclude full content, use excerpt only)
3. Check browser memory usage

## Future Enhancements (Optional)

- Search suggestions/autocomplete
- Search filters (by category, date, author)
- Sort by relevance
- Fuzzy matching
- Search analytics

---

*This is a simple, effective client-side search solution perfect for GitHub Pages hosting.*
